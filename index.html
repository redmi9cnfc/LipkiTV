<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LipkiTV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --accent:#6366f1;
  --accent2:#7c3aed;
  --text:#f1f5f9;
  --muted:#94a3b8;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Arial;
  height:100vh;
  display:flex;
}

.app{
  display:flex;
  flex-direction:column;
  width:100%;
  padding:12px;
  gap:12px;
}

.logo{
  text-align:center;
  font-size:26px;
  font-weight:bold;
  color:var(--accent);
}

.video-wrap{
  background:black;
  border-radius:16px;
  overflow:hidden;
  aspect-ratio:16/9;
  box-shadow:0 10px 25px rgba(0,0,0,0.5);
}

video{
  width:100%;
  height:100%;
}

#now{
  text-align:center;
  color:var(--muted);
  font-size:14px;
}

.groups{
  display:flex;
  gap:8px;
  overflow-x:auto;
  scrollbar-width:none;
}

.groups::-webkit-scrollbar{ display:none; }

.group{
  padding:8px 14px;
  border-radius:20px;
  background:var(--card);
  cursor:pointer;
  white-space:nowrap;
  font-size:14px;
  transition:0.2s;
}

.group.active{
  background:var(--accent);
}

#search{
  padding:10px;
  border-radius:8px;
  border:none;
  background:#0b1220;
  color:white;
  font-size:14px;
}

.channels-holder{
  flex:1;
  overflow-y:auto;
}

.channels{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:10px;
}

.channel{
  background:var(--card);
  padding:10px;
  border-radius:12px;
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
  transition:0.2s;
}

.channel:hover{
  background:var(--accent2);
}

.channel img{
  width:38px;
  height:38px;
  object-fit:contain;
  border-radius:6px;
}

@media(min-width:1600px){
  .channel{
    font-size:18px;
    padding:16px;
  }
}
</style>
</head>

<body>

<div class="app">

  <div class="logo">LipkiTV</div>

  <div class="video-wrap">
    <video id="video" controls playsinline></video>
  </div>

  <div id="now">Выберите канал</div>

  <div class="groups" id="groups"></div>

  <input id="search" placeholder="Поиск канала..." type="text">

  <div class="channels-holder">
    <div id="channels" class="channels"></div>
  </div>

</div>

<script>
const PLAYLIST_URL =
"https://raw.githubusercontent.com/LinTV-OFFICAL/LinTV/refs/heads/main/LinIPTV.m3u";

const video = document.getElementById("video");
const groupsEl = document.getElementById("groups");
const channelsEl = document.getElementById("channels");
const searchInput = document.getElementById("search");
const nowEl = document.getElementById("now");

let channels = [];
let currentGroup = null;
let hls = null;

async function loadPlaylist(){
  try{
    const response = await fetch(PLAYLIST_URL);
    const text = await response.text();
    parseM3U(text);
  }catch(e){
    nowEl.textContent = "Ошибка загрузки плейлиста";
  }
}

function parseM3U(text){
  channels = [];
  const lines = text.split("\n");
  let meta = null;

  for(let line of lines){
    line = line.trim();

    if(line.startsWith("#EXTINF")){
      meta = line;
    }
    else if(line && !line.startsWith("#")){
      let name = line;
      let group = "Другие";
      let logo = "";

      if(meta){
        const parts = meta.split(",");
        if(parts.length>1) name = parts.pop().trim();

        const g = meta.match(/group-title="([^"]+)"/i);
        if(g) group = g[1];

        const l = meta.match(/tvg-logo="([^"]+)"/i);
        if(l) logo = l[1];
      }

      channels.push({name, url:line, group, logo});
      meta=null;
    }
  }

  renderGroups();
}

function renderGroups(){
  const groups = [...new Set(channels.map(c=>c.group))];
  groupsEl.innerHTML="";

  groups.forEach(g=>{
    const el=document.createElement("div");
    el.className="group";
    el.textContent=g;
    el.onclick=()=>selectGroup(g);
    groupsEl.appendChild(el);
  });

  if(groups.length>0) selectGroup(groups[0]);
}

function selectGroup(g){
  currentGroup=g;
  [...groupsEl.children].forEach(el=>{
    el.classList.toggle("active",el.textContent===g);
  });
  renderChannels();
}

function renderChannels(){
  const q = searchInput.value.toLowerCase();
  channelsEl.innerHTML="";

  channels
    .filter(c=>c.group===currentGroup && c.name.toLowerCase().includes(q))
    .forEach(c=>{
      const el=document.createElement("div");
      el.className="channel";
      el.innerHTML = `
        ${c.logo ? `<img src="${c.logo}">` : ""}
        <div>${c.name}</div>
      `;
      el.onclick=()=>play(c);
      channelsEl.appendChild(el);
    });
}

searchInput.oninput = renderChannels;

function play(channel){
  if(hls) hls.destroy();
  nowEl.textContent = channel.name;

  if(Hls.isSupported() && channel.url.includes(".m3u8")){
    hls = new Hls({
      maxBufferLength: 30,
      enableWorker: true
    });
    hls.loadSource(channel.url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
  } else {
    video.src = channel.url;
    video.play();
  }
}

loadPlaylist();
</script>

</body>
</html>